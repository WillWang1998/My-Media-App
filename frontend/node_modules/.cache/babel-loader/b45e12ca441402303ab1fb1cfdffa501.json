{"ast":null,"code":"import _regeneratorRuntime from\"/Users/willwang98/Rice Homework/final-frontend-WillWang1998/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/willwang98/Rice Homework/final-frontend-WillWang1998/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/willwang98/Rice Homework/final-frontend-WillWang1998/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{memo,useEffect,useRef,useState}from\"react\";import{Card,Input,List,message}from\"antd\";import Comment from\"./Comment\";import{showBackendMessage,stringArrayEqual}from\"../util/Functions\";// TODO: Comments sort\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Comments=function Comments(props){message.config({rtl:false});var commentRef=useRef();var _useState=useState(props.commentIdList),_useState2=_slicedToArray(_useState,2),commentIdList=_useState2[0],setCommentIdList=_useState2[1];useEffect(function(){setCommentIdList(function(commentIdList){return props.commentIdList.reverse();});},[props]);var addNewComment=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(value){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(value){_context.next=3;break;}message.error(\"Please input your comment!\",1);return _context.abrupt(\"return\");case 3:_context.next=5;return fetch(\"https://comp531-rw48-mymedia-backend.herokuapp.com/comment\",{method:\"POST\",credentials:\"include\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({articleID:props.articleId,text:value})}).then(function(res){if(res.ok){showBackendMessage();return res.json();}else{throw res.statusText;}}).then(function(res){setCommentIdList(function(commentIdList){return res.comments.reverse();});commentRef.current.setValue(\"\");message.success(\"Comment Successfully!\",1);}).catch(function(err){return message.error(err,1);});case 5:case\"end\":return _context.stop();}}},_callee);}));return function addNewComment(_x){return _ref.apply(this,arguments);};}();var onDeleteComment=function onDeleteComment(id){setCommentIdList(function(commentIdList){return commentIdList.filter(function(item){return item!==id;});});};var MemoList=function MemoList(_props){return/*#__PURE__*/_jsx(List,{header:\"\".concat(_props.commentIdList?_props.commentIdList.length:0,\" replies\"),itemLayout:\"horizontal\",dataSource:_props.commentIdList,renderItem:function renderItem(item){return/*#__PURE__*/_jsx(Comment,{articleId:props.articleId,id:item,deleteAction:onDeleteComment});}});};var areEqualMemoList=function areEqualMemoList(prevProps,nextProps){return stringArrayEqual(prevProps.commentIdList,nextProps.commentIdList);};/*#__PURE__*/memo(MemoList,areEqualMemoList);return/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(MemoList,{commentIdList:commentIdList}),/*#__PURE__*/_jsx(Input.Search,{allowClear:true,onSearch:addNewComment,ref:commentRef,enterButton:\"Comment\"})]});};// const areEqualComments = (prevProps, nextProps) => {\n//     return stringArrayEqual(prevProps.commentIdList, nextProps.commentIdList);\n// }\n//\n// export default memo(Comments, areEqualComments);\nexport default Comments;","map":{"version":3,"sources":["/Users/willwang98/Rice Homework/final-frontend-WillWang1998/src/component/Comments.js"],"names":["React","memo","useEffect","useRef","useState","Card","Input","List","message","Comment","showBackendMessage","stringArrayEqual","Comments","props","config","rtl","commentRef","commentIdList","setCommentIdList","reverse","addNewComment","value","error","fetch","method","credentials","headers","body","JSON","stringify","articleID","articleId","text","then","res","ok","json","statusText","comments","current","setValue","success","catch","err","onDeleteComment","id","filter","item","MemoList","_props","length","areEqualMemoList","prevProps","nextProps"],"mappings":"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","sourcesContent":["import React, {memo, useEffect, useRef, useState} from \"react\";\nimport {Card, Input, List, message} from \"antd\";\nimport Comment from \"./Comment\";\nimport {showBackendMessage, stringArrayEqual} from \"../util/Functions\";\n\n\n// TODO: Comments sort\nconst Comments = (props) => {\n    message.config({\n        rtl: false,\n    });\n\n    const commentRef = useRef();\n    const [commentIdList, setCommentIdList] = useState(props.commentIdList);\n\n    useEffect(() => {\n        setCommentIdList(commentIdList => props.commentIdList.reverse());\n    }, [props]);\n\n    const addNewComment = async (value) => {\n        if (!value) {\n            message.error(\"Please input your comment!\", 1);\n            return;\n        }\n        await fetch(\"https://comp531-rw48-mymedia-backend.herokuapp.com/comment\", {\n            method: \"POST\",\n            credentials: \"include\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                articleID: props.articleId,\n                text: value,\n            }),\n        }).then(res => {\n            if (res.ok) {\n                showBackendMessage();\n                return res.json();\n            } else {\n                throw res.statusText;\n            }\n        }).then(res => {\n            setCommentIdList(commentIdList => res.comments.reverse());\n            commentRef.current.setValue(\"\");\n            message.success(\"Comment Successfully!\", 1);\n        }).catch(err => message.error(err, 1));\n    }\n\n    const onDeleteComment = (id) => {\n        setCommentIdList(commentIdList => commentIdList.filter((item) => {\n            return item !== id;\n        }));\n    }\n\n\n    const MemoList = (_props) => {\n        return (\n            <List\n                header={`${_props.commentIdList ? _props.commentIdList.length : 0} replies`}\n                itemLayout=\"horizontal\"\n                dataSource={_props.commentIdList}\n                renderItem={item => <Comment articleId={props.articleId}\n                                             id={item}\n                                             deleteAction={onDeleteComment}/>}\n            />\n        )\n    }\n\n    const areEqualMemoList = (prevProps, nextProps) => {\n        return stringArrayEqual(prevProps.commentIdList, nextProps.commentIdList);\n    }\n\n    memo(MemoList, areEqualMemoList);\n\n    return (\n        <Card>\n            <MemoList commentIdList={commentIdList}/>\n            <Input.Search\n                allowClear\n                onSearch={addNewComment}\n                ref={commentRef}\n                enterButton=\"Comment\"/>\n        </Card>\n    )\n}\n\n// const areEqualComments = (prevProps, nextProps) => {\n//     return stringArrayEqual(prevProps.commentIdList, nextProps.commentIdList);\n// }\n//\n// export default memo(Comments, areEqualComments);\n\nexport default Comments;\n"]},"metadata":{},"sourceType":"module"}