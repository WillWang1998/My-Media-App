{"ast":null,"code":"import _regeneratorRuntime from\"/Users/willwang98/Rice Homework/final-frontend-WillWang1998/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/willwang98/Rice Homework/final-frontend-WillWang1998/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/willwang98/Rice Homework/final-frontend-WillWang1998/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{Button,Input,Comment as AntdComment,message}from\"antd\";import{DeleteOutlined,EditOutlined}from\"@ant-design/icons\";import{showBackendMessage}from\"../util/Functions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Comment=function Comment(props){message.config({rtl:false});var _useState=useState(true),_useState2=_slicedToArray(_useState,2),hideEditor=_useState2[0],setHideEditor=_useState2[1];var _useState3=useState(props.id),_useState4=_slicedToArray(_useState3,2),id=_useState4[0],setId=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),username=_useState6[0],setUsername=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),author=_useState8[0],setAuthor=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),authorDisplayedName=_useState10[0],setAuthorDisplayedName=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),avatar=_useState12[0],setAvatar=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),text=_useState14[0],setText=_useState14[1];var _useState15=useState(0),_useState16=_slicedToArray(_useState15,2),timeStamp=_useState16[0],setTimeStamp=_useState16[1];var load=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(\"http://localhost:4000/comment/\"+id,{method:\"GET\",credentials:\"include\"}).then(function(res){if(res.ok){showBackendMessage();return res.json();}else{throw res.statusText;}}).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(res){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setAuthor(res.author);setUsername(res.username);setText(res.text);setTimeStamp(res.timestamp);_context.next=6;return fetch(\"http://localhost:4000/profile/\"+res.author,{method:\"GET\",credentials:\"include\"}).then(function(res){if(res.ok){showBackendMessage();return res.json();}else{throw res.statusText;}}).then(function(res){setAuthorDisplayedName(res.displayedName);setAvatar(res.avatar);}).catch(function(err){return message.error(err,1);});case 6:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}()).catch(function(err){return message.error(err,1);});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function load(){return _ref.apply(this,arguments);};}();var onDelete=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetch(\"http://localhost:4000/comment/\"+id,{method:\"DELETE\",credentials:\"include\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({articleId:props.articleId})}).then(function(res){if(res.ok){showBackendMessage();return res.json();}else{throw res.statusText;}}).then(function(){props.deleteAction(props.id);message.success(\"Delete successfully!\");}).catch(function(err){return message.error(err,1);});case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function onDelete(){return _ref3.apply(this,arguments);};}();var onSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(value){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(value){_context4.next=3;break;}message.error(\"Please input your comment!\",1);return _context4.abrupt(\"return\");case 3:_context4.next=5;return fetch(\"http://localhost:4000/comment/\"+id,{method:\"PUT\",credentials:\"include\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({text:value})}).then(function(res){if(res.ok){showBackendMessage();return res.json();}else{throw res.statusText;}}).then(function(res){setText(res.text);message.success(\"Update successfully!\");}).catch(function(err){return message.error(err,1);});case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function onSubmit(_x2){return _ref4.apply(this,arguments);};}();useEffect(function(){return load();},[]);return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(AntdComment,{author:authorDisplayedName,avatar:avatar,content:text,actions:username===author?[/*#__PURE__*/_jsxs(Button,{type:\"link\",onClick:function onClick(){return setHideEditor(!hideEditor);},children:[/*#__PURE__*/_jsx(EditOutlined,{}),\"Edit\"]}),/*#__PURE__*/_jsxs(Button,{type:\"link\",onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:setHideEditor(true);_context5.next=3;return onDelete();case 3:case\"end\":return _context5.stop();}}},_callee5);})),children:[/*#__PURE__*/_jsx(DeleteOutlined,{}),\"Delete\"]})]:[],datetime:new Date(timeStamp).toLocaleString()}),/*#__PURE__*/_jsx(\"div\",{hidden:hideEditor,children:/*#__PURE__*/_jsx(Input.Search,{allowClear:true,onSearch:onSubmit,defaultValue:text,enterButton:\"Comment\"})})]});};export default Comment;","map":{"version":3,"sources":["/Users/willwang98/Rice Homework/final-frontend-WillWang1998/src/component/Comment.js"],"names":["React","useEffect","useState","Button","Input","Comment","AntdComment","message","DeleteOutlined","EditOutlined","showBackendMessage","props","config","rtl","hideEditor","setHideEditor","id","setId","username","setUsername","author","setAuthor","authorDisplayedName","setAuthorDisplayedName","avatar","setAvatar","text","setText","timeStamp","setTimeStamp","load","fetch","method","credentials","then","res","ok","json","statusText","timestamp","displayedName","catch","err","error","onDelete","headers","body","JSON","stringify","articleId","deleteAction","success","onSubmit","value","Date","toLocaleString"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\nimport {Button, Input, Comment as AntdComment, message} from \"antd\";\nimport {DeleteOutlined, EditOutlined} from \"@ant-design/icons\";\nimport {showBackendMessage} from \"../util/Functions\";\n\nconst Comment = (props) => {\n    message.config({\n        rtl: false,\n    });\n\n    const [hideEditor, setHideEditor] = useState(true);\n    const [id, setId] = useState(props.id);\n    const [username, setUsername] = useState(\"\");\n    const [author, setAuthor] = useState(\"\");\n    const [authorDisplayedName, setAuthorDisplayedName] = useState(\"\");\n    const [avatar, setAvatar] = useState(\"\");\n    const [text, setText] = useState(\"\");\n    const [timeStamp, setTimeStamp] = useState(0);\n\n    const load = async () => {\n        await fetch(\"http://localhost:4000/comment/\" + id, {\n            method: \"GET\",\n            credentials: \"include\"\n        }).then(res => {\n            if (res.ok) {\n                showBackendMessage();\n                return res.json();\n            } else {\n                throw res.statusText;\n            }\n        }).then(async res => {\n            setAuthor(res.author);\n            setUsername(res.username);\n            setText(res.text);\n            setTimeStamp(res.timestamp);\n            await fetch(\"http://localhost:4000/profile/\" + res.author, {\n                method: \"GET\",\n                credentials: \"include\",\n            }).then(res => {\n                if (res.ok) {\n                    showBackendMessage();\n                    return res.json();\n                } else {\n                    throw res.statusText;\n                }\n            }).then(res => {\n                setAuthorDisplayedName(res.displayedName);\n                setAvatar(res.avatar);\n            }).catch(err => message.error(err, 1));\n        }).catch(err => message.error(err, 1));\n    }\n\n    const onDelete = async () => {\n        await fetch(\"http://localhost:4000/comment/\" + id, {\n            method: \"DELETE\",\n            credentials: \"include\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                articleId: props.articleId,\n            })\n        }).then(res => {\n            if (res.ok) {\n                showBackendMessage();\n                return res.json();\n            } else {\n                throw res.statusText;\n            }\n        }).then(() => {\n            props.deleteAction(props.id);\n            message.success(\"Delete successfully!\");\n        }).catch(err => message.error(err, 1));\n    };\n\n    const onSubmit = async (value) => {\n        if (!value) {\n            message.error(\"Please input your comment!\", 1);\n            return;\n        }\n        await fetch(\"http://localhost:4000/comment/\" + id, {\n            method: \"PUT\",\n            credentials: \"include\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                text: value,\n            }),\n        }).then(res => {\n            if (res.ok) {\n                showBackendMessage();\n                return res.json();\n            } else {\n                throw res.statusText;\n            }\n        }).then(res => {\n            setText(res.text);\n            message.success(\"Update successfully!\");\n        }).catch(err => message.error(err, 1));\n    }\n\n    useEffect(() => load(), []);\n\n    return (\n        <li>\n        <AntdComment\n            author={authorDisplayedName}\n            avatar={avatar}\n            content={text}\n            actions={\n                username === author ? [\n                    <Button type=\"link\" onClick={() => setHideEditor(!hideEditor)}>\n                        <EditOutlined/>Edit\n                    </Button>,\n                    <Button type=\"link\" onClick={async () => {\n                        setHideEditor(true)\n                        await onDelete();\n                    }}>\n                        <DeleteOutlined/>Delete\n                    </Button>\n                ] : []\n            }\n            datetime={(new Date(timeStamp)).toLocaleString()}\n        />\n        <div hidden={hideEditor}>\n            <Input.Search\n                allowClear\n                onSearch={onSubmit}\n                defaultValue={text}\n                enterButton=\"Comment\"\n            />\n        </div>\n        </li>\n    )\n};\n\nexport default Comment;\n"]},"metadata":{},"sourceType":"module"}