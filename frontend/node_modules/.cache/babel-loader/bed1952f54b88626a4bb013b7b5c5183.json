{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/willwang98/Rice Homework/final-frontend-WillWang1998/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"/Users/willwang98/Rice Homework/final-frontend-WillWang1998/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/willwang98/Rice Homework/final-frontend-WillWang1998/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/willwang98/Rice Homework/final-frontend-WillWang1998/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";// TODO: The wall is using a \"stack\", need to become \"array(vector).\"\nimport React,{memo,useEffect,useState}from\"react\";import{PlusOutlined}from\"@ant-design/icons\";import{Modal,Upload}from\"antd\";import EventBus from\"../util/EventBus\";import{stringArrayEqual}from\"../util/Functions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var getBase64=function getBase64(file){return new Promise(function(resolve,reject){var reader=new FileReader();reader.readAsDataURL(file);reader.onload=function(){return resolve(reader.result);};reader.onerror=function(error){return reject(error);};});};var urlsToFiles=function urlsToFiles(urls){if(urls){return urls.map(function(item){var fileName=item.split(\"/\").slice(-1)[0];var fileUid=fileName.split(\".\").slice(0,-1).join(\"\");return{uid:fileUid,name:fileName,status:'done',url:item};});}else{return[];}};var ImagesWall=function ImagesWall(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),previewVisible=_useState2[0],setPreviewVisible=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),previewImage=_useState4[0],setPreviewImage=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),previewTitle=_useState6[0],setPreviewTitle=_useState6[1];var _useState7=useState(urlsToFiles(props.imageUrlsList)),_useState8=_slicedToArray(_useState7,2),fileList=_useState8[0],setFileList=_useState8[1];useEffect(function(){setFileList(function(fileList){return urlsToFiles(props.imageUrlsList);});},[props]);var handleCancel=function handleCancel(){setPreviewVisible(false);};var handlePreview=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(file){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!file.url&&!file.preview)){_context.next=4;break;}_context.next=3;return getBase64(file.originFileObj);case 3:file.preview=_context.sent;case 4:setPreviewImage(file.url||file.preview);setPreviewVisible(true);setPreviewTitle(file.name||file.url.substring(file.url.lastIndexOf('/')+1));case 7:case\"end\":return _context.stop();}}},_callee);}));return function handlePreview(_x){return _ref.apply(this,arguments);};}();var handleChange=function handleChange(_ref2){var fileList=_ref2.fileList;setFileList(fileList);var fileListStatus=[];fileList.forEach(function(item){return fileListStatus.push(item.status);});if(fileListStatus.every(function(item){return item===\"done\";})){var curImageUrlsList=[];var _iterator=_createForOfIteratorHelper(fileList),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var file=_step.value;curImageUrlsList.push(file.url||file.response.url);}}catch(err){_iterator.e(err);}finally{_iterator.f();}props.action(function(imageUrlsList){return curImageUrlsList;});}};var uploadButton=/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(PlusOutlined,{}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8},children:\"Upload\"})]});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Upload,{name:\"image\",action:\"http://localhost:4000/upload/image\",withCredentials:true,listType:\"picture-card\",fileList:fileList,onPreview:handlePreview,onChange:handleChange,children:fileList.length>=8?null:uploadButton}),/*#__PURE__*/_jsx(Modal,{visible:previewVisible,title:previewTitle,footer:null,onCancel:handleCancel,children:/*#__PURE__*/_jsx(\"img\",{alt:\"example\",style:{width:'100%'},src:previewImage})})]});};var areEqualImagesWall=function areEqualImagesWall(prevProps,nextProps){return stringArrayEqual(prevProps.imageUrlsList,nextProps.imageUrlsList);};export default/*#__PURE__*/memo(ImagesWall,areEqualImagesWall);","map":{"version":3,"sources":["/Users/willwang98/Rice Homework/final-frontend-WillWang1998/src/component/ImageWall.js"],"names":["React","memo","useEffect","useState","PlusOutlined","Modal","Upload","EventBus","stringArrayEqual","getBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","urlsToFiles","urls","map","item","fileName","split","slice","fileUid","join","uid","name","status","url","ImagesWall","props","previewVisible","setPreviewVisible","previewImage","setPreviewImage","previewTitle","setPreviewTitle","imageUrlsList","fileList","setFileList","handleCancel","handlePreview","preview","originFileObj","substring","lastIndexOf","handleChange","fileListStatus","forEach","push","every","curImageUrlsList","response","action","uploadButton","marginTop","length","width","areEqualImagesWall","prevProps","nextProps"],"mappings":"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","sourcesContent":["// TODO: The wall is using a \"stack\", need to become \"array(vector).\"\nimport React, {memo, useEffect, useState} from \"react\";\nimport {PlusOutlined} from \"@ant-design/icons\";\nimport {Modal, Upload} from \"antd\";\nimport EventBus from \"../util/EventBus\";\nimport {stringArrayEqual} from \"../util/Functions\";\n\n\nconst getBase64 = (file) => {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.readAsDataURL(file);\n        reader.onload = () => resolve(reader.result);\n        reader.onerror = error => reject(error);\n    });\n}\n\nconst urlsToFiles = (urls) => {\n    if (urls) {\n        return urls.map((item) => {\n            let fileName = item.split(\"/\").slice(-1)[0];\n            let fileUid = fileName.split(\".\").slice(0, -1).join(\"\");\n            return {\n                uid: fileUid,\n                name: fileName,\n                status: 'done',\n                url: item,\n            }\n        })\n    } else {\n        return [];\n    }\n}\n\nconst ImagesWall = (props) => {\n    const [previewVisible, setPreviewVisible] = useState(false);\n    const [previewImage, setPreviewImage] = useState(\"\");\n    const [previewTitle, setPreviewTitle] = useState(\"\");\n    const [fileList, setFileList] = useState(urlsToFiles(props.imageUrlsList));\n\n    useEffect(() => {\n        setFileList(fileList => urlsToFiles(props.imageUrlsList));\n    }, [props]);\n\n    const handleCancel = () => {\n        setPreviewVisible(false);\n    }\n\n    const handlePreview = async (file) => {\n        if (!file.url && !file.preview) {\n            file.preview = await getBase64(file.originFileObj);\n        }\n        setPreviewImage(file.url || file.preview);\n        setPreviewVisible(true);\n        setPreviewTitle(\n            file.name || file.url.substring(file.url.lastIndexOf('/') + 1),\n        );\n    };\n\n    const handleChange = ({ fileList }) => {\n        setFileList(fileList);\n        let fileListStatus = [];\n        fileList.forEach(item => fileListStatus.push(item.status));\n        if (fileListStatus.every(item => item === \"done\")) {\n            let curImageUrlsList = [];\n            for (let file of fileList) {\n                curImageUrlsList.push(file.url || file.response.url);\n            }\n            props.action(imageUrlsList => curImageUrlsList);\n        }\n    };\n\n    const uploadButton = (\n        <div>\n            <PlusOutlined />\n            <div style={{ marginTop: 8 }}>Upload</div>\n        </div>\n    );\n\n    return (\n        <>\n            <Upload\n                name=\"image\"\n                action=\"http://localhost:4000/upload/image\"\n                withCredentials={true}\n                listType=\"picture-card\"\n                fileList={fileList}\n                onPreview={handlePreview}\n                onChange={handleChange}\n            >\n                {fileList.length >= 8 ? null : uploadButton}\n            </Upload>\n            <Modal\n                visible={previewVisible}\n                title={previewTitle}\n                footer={null}\n                onCancel={handleCancel}\n            >\n                <img alt=\"example\" style={{ width: '100%' }} src={previewImage} />\n            </Modal>\n        </>\n    );\n};\n\nconst areEqualImagesWall = (prevProps, nextProps) => {\n    return stringArrayEqual(prevProps.imageUrlsList, nextProps.imageUrlsList);\n}\n\nexport default memo(ImagesWall, areEqualImagesWall);\n"]},"metadata":{},"sourceType":"module"}